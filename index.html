<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Food2Energy â€” AI-Powered Sustainability Dashboard</title>
  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
  <style>
    :root {
      --food-waste: #16a34a;        /* Green */
      --methane-avoided: #000066;   /* Dark Blue */
      --fertilizer: #F2D000;        /* Yellow */
      --biogas: #FF8C00;            /* Orange */
      --carbon-credits: #4B0082;    /* Indigo Purple */
      --ai-primary: #9333EA;        /* Purple for AI elements */
      --ai-secondary: #EC4899;      /* Pink for AI elements */
      --neutral: #1e293b;
      --light: #f8fafc;
      --light-gray: #f1f5f9;
      --mid-gray: #e2e8f0;
      --text: #334155;
      --text-light: #64748b;
      --focus-ring: 0 0 0 3px rgba(147, 51, 234, 0.3);
    }
    
    * {
      box-sizing: border-box;
      margin: 0;
      padding: 0;
    }
    
    body {
      font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
      background: var(--light);
      color: var(--text);
      line-height: 1.6;
      padding: 0;
    }
    
    .container {
      max-width: 1400px;
      margin: 0 auto;
      padding: 20px;
    }
    
    /* Skip link for accessibility */
    .skip-link {
      position: absolute;
      top: -40px;
      left: 0;
      background: var(--ai-primary);
      color: white;
      padding: 8px;
      z-index: 100;
      transition: top 0.3s;
    }
    
    .skip-link:focus {
      top: 0;
    }
    
    /* Header */
    header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      padding: 20px 0;
      margin-bottom: 10px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .logo {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .logo-icon {
      width: 40px;
      height: 40px;
      background: var(--food-waste);
      border-radius: 8px;
      display: flex;
      align-items: center;
      justify-content: center;
      color: white;
      font-size: 20px;
    }
    
    .logo-text h1 {
      font-size: 24px;
      font-weight: 700;
      color: var(--neutral);
      margin: 0;
    }
    
    .logo-text p {
      font-size: 14px;
      color: var(--text-light);
      margin: 0;
    }
    
    .header-controls {
      display: flex;
      align-items: center;
      gap: 15px;
      flex-wrap: wrap;
    }
    
    #toggleBtn, .export-btn {
      background: white;
      border: 1px solid var(--mid-gray);
      border-radius: 8px;
      padding: 10px 16px;
      font-weight: 600;
      color: var(--text);
      cursor: pointer;
      transition: all 0.2s;
      display: flex;
      align-items: center;
      gap: 8px;
      box-shadow: 0 2px 4px rgba(0,0,0,0.05);
    }
    
    #toggleBtn:hover, .export-btn:hover {
      background: var(--light-gray);
    }
    
    #toggleBtn:focus, .export-btn:focus, select:focus {
      outline: none;
      box-shadow: var(--focus-ring);
    }
    
    /* KPI Cards */
    .kpis {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 16px;
      margin-bottom: 24px;
    }
    
    .card {
      background: white;
      border-radius: 12px;
      padding: 20px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      display: flex;
      flex-direction: column;
      gap: 12px;
      transition: transform 0.2s;
    }
    
    .card:hover {
      transform: translateY(-3px);
    }
    
    .card-header {
      display: flex;
      align-items: center;
      gap: 12px;
    }
    
    .card-icon {
      width: 44px;
      height: 44px;
      border-radius: 10px;
      display: flex;
      align-items: center;
      justify-content: center;
      font-size: 20px;
      flex-shrink: 0;
      color: white;
    }
    
    .card-title {
      font-size: 14px;
      color: var(--text-light);
      font-weight: 500;
    }
    
    .card-value {
      font-size: 24px;
      font-weight: 700;
      color: var(--neutral);
    }
    
    .card-trend {
      font-size: 12px;
      display: flex;
      align-items: center;
      gap: 4px;
      padding: 6px 10px;
      background: var(--light-gray);
      border-radius: 20px;
      width: fit-content;
    }
    
    /* AI Score Card */
    .ai-score-card {
      background: linear-gradient(135deg, var(--ai-primary), var(--ai-secondary));
      color: white;
    }
    
    .ai-score-card .card-title,
    .ai-score-card .card-value {
      color: white;
    }
    
    .ai-score-card .card-trend {
      background: rgba(255, 255, 255, 0.2);
      color: white;
    }
    
    /* Card Colors */
    .card:nth-child(1) .card-icon {
      background: var(--food-waste);
    }
    
    .card:nth-child(2) .card-icon {
      background: var(--biogas);
    }
    
    .card:nth-child(3) .card-icon {
      background: var(--fertilizer);
      color: #333; /* Dark text for better contrast on yellow */
    }
    
    .card:nth-child(4) .card-icon {
      background: var(--methane-avoided);
    }
    
    .card:nth-child(5) .card-icon {
      background: var(--carbon-credits);
    }
    
    .card:nth-child(6) .card-icon {
      background: var(--ai-primary);
    }
    
    /* Charts Layout */
    .dashboard-content {
      display: grid;
      grid-template-columns: 1fr;
      gap: 24px;
      margin-bottom: 30px;
    }
    
    .panel {
      background: white;
      border-radius: 12px;
      padding: 24px;
      box-shadow: 0 2px 8px rgba(0,0,0,0.06);
      position: relative;
    }
    
    .panel-header {
      display: flex;
      justify-content: space-between;
      align-items: center;
      margin-bottom: 20px;
      flex-wrap: wrap;
      gap: 15px;
    }
    
    .panel-title {
      font-size: 18px;
      font-weight: 600;
      color: var(--neutral);
    }
    
    .chart-container {
      position: relative;
      height: 300px;
    }
    
    .chart-grid {
      display: grid;
      grid-template-columns: 1fr 1fr;
      gap: 24px;
    }
    
    /* Chart controls */
    .chart-controls {
      display: flex;
      gap: 10px;
      margin-top: 15px;
    }
    
    .chart-btn {
      padding: 6px 12px;
      background: var(--light-gray);
      border: none;
      border-radius: 6px;
      cursor: pointer;
      font-size: 13px;
      transition: background 0.2s;
    }
    
    .chart-btn:hover {
      background: var(--mid-gray);
    }
    
    .chart-btn.active {
      background: var(--ai-primary);
      color: white;
    }
    
    /* AI Panel */
    .ai-panel {
      display: flex;
      flex-direction: column;
      gap: 20px;
    }
    
    .recommendation {
      padding: 16px;
      border-radius: 10px;
      font-size: 14px;
      display: flex;
      align-items: flex-start;
      gap: 12px;
      line-height: 1.5;
    }
    
    .recommendation i {
      font-size: 18px;
      margin-top: 2px;
      flex-shrink: 0;
    }
    
    .good { 
      background: rgba(34, 197, 94, 0.08);
      border-left: 3px solid #16a34a;
    }
    
    .warning { 
      background: rgba(245, 158, 11, 0.08);
      border-left: 3px solid #f59e0b;
    }
    
    .alert { 
      background: rgba(239, 68, 68, 0.08);
      border-left: 3px solid #ef4444;
    }
    
    .notice { 
      background: rgba(59, 130, 246, 0.08);
      border-left: 3px solid #3b82f6;
    }
    
    .ai-insight { 
      background: rgba(147, 51, 234, 0.08);
      border-left: 3px solid var(--ai-primary);
    }
    
    .sensor-snapshot {
      background: var(--light-gray);
      border-radius: 10px;
      padding: 20px;
    }
    
    .sensor-title {
      font-size: 16px;
      font-weight: 600;
      margin-bottom: 15px;
      color: var(--neutral);
    }
    
    .sensor-data {
      display: grid;
      grid-template-columns: repeat(2, 1fr);
      gap: 12px;
    }
    
    .sensor-item {
      display: flex;
      flex-direction: column;
    }
    
    .sensor-label {
      font-size: 12px;
      color: var(--text-light);
      margin-bottom: 4px;
    }
    
    .sensor-value {
      font-size: 18px;
      font-weight: 700;
      color: var(--neutral);
    }
    
    /* AI Efficiency Section */
    .ai-efficiency {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--mid-gray);
    }
    
    .efficiency-metrics {
      display: grid;
      grid-template-columns: repeat(3, 1fr);
      gap: 15px;
      margin-top: 15px;
    }
    
    .efficiency-metric {
      text-align: center;
      padding: 15px;
      background: var(--light-gray);
      border-radius: 10px;
    }
    
    .metric-value {
      font-size: 24px;
      font-weight: 700;
      margin-bottom: 5px;
      color: var(--ai-primary);
    }
    
    .metric-label {
      font-size: 12px;
      color: var(--text-light);
    }
    
    /* Forecast Section */
    .forecast-container {
      position: relative;
      height: 250px;
      margin-top: 30px;
    }
    
    .forecast-explanation {
      margin-top: 15px;
      padding: 12px;
      background: var(--light-gray);
      border-radius: 8px;
      font-size: 14px;
    }
    
    /* Anomaly Indicator */
    .anomaly-indicator {
      display: inline-flex;
      align-items: center;
      padding: 4px 10px;
      border-radius: 20px;
      font-size: 12px;
      font-weight: 600;
      margin-left: 10px;
    }
    
    .anomaly-none {
      background: rgba(34, 197, 94, 0.15);
      color: #16a34a;
    }
    
    .anomaly-minor {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }
    
    .anomaly-major {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }
    
    /* AI Alert Center */
    .alert-center {
      margin-top: 20px;
      padding-top: 20px;
      border-top: 1px solid var(--mid-gray);
    }
    
    .alert-item {
      display: flex;
      align-items: center;
      padding: 12px;
      border-radius: 8px;
      margin-bottom: 10px;
      background: var(--light-gray);
    }
    
    .alert-icon {
      width: 36px;
      height: 36px;
      border-radius: 50%;
      display: flex;
      align-items: center;
      justify-content: center;
      margin-right: 12px;
      flex-shrink: 0;
    }
    
    .alert-info {
      flex-grow: 1;
    }
    
    .alert-title {
      font-weight: 600;
      margin-bottom: 4px;
    }
    
    .alert-desc {
      font-size: 12px;
      color: var(--text-light);
    }
    
    .alert-high {
      border-left: 4px solid #ef4444;
    }
    
    .alert-high .alert-icon {
      background: rgba(239, 68, 68, 0.15);
      color: #ef4444;
    }
    
    .alert-medium {
      border-left: 4px solid #f59e0b;
    }
    
    .alert-medium .alert-icon {
      background: rgba(245, 158, 11, 0.15);
      color: #f59e0b;
    }
    
    .alert-low {
      border-left: 4px solid #3b82f6;
    }
    
    .alert-low .alert-icon {
      background: rgba(59, 130, 246, 0.15);
      color: #3b82f6;
    }
    
    /* Loading states */
    .loading {
      position: relative;
      overflow: hidden;
    }
    
    .loading::after {
      content: '';
      position: absolute;
      top: 0;
      right: 0;
      bottom: 0;
      left: 0;
      transform: translateX(-100%);
      background: linear-gradient(
        90deg,
        rgba(255, 255, 255, 0) 0,
        rgba(255, 255, 255, 0.2) 20%,
        rgba(255, 255, 255, 0.5) 60%,
        rgba(255, 255, 255, 0)
      );
      animation: shimmer 2s infinite;
    }
    
    @keyframes shimmer {
      100% {
        transform: translateX(100%);
      }
    }
    
    /* Footer */
    footer {
      text-align: center;
      padding: 20px;
      font-size: 14px;
      color: var(--text-light);
      margin-top: 30px;
    }
    
    /* Responsive */
    @media (min-width: 1024px) {
      .dashboard-content {
        grid-template-columns: 2fr 1fr;
      }
    }
    
    @media (max-width: 1023px) {
      .chart-grid {
        grid-template-columns: 1fr;
      }
      
      .efficiency-metrics {
        grid-template-columns: 1fr 1fr;
      }
    }
    
    @media (max-width: 768px) {
      .kpis {
        grid-template-columns: 1fr 1fr;
      }
      
      header {
        flex-direction: column;
        align-items: flex-start;
        gap: 15px;
      }
      
      .header-controls {
        width: 100%;
        justify-content: space-between;
      }
      
      .sensor-data {
        grid-template-columns: 1fr;
      }
      
      .efficiency-metrics {
        grid-template-columns: 1fr;
      }
      
      .chart-controls {
        flex-wrap: wrap;
      }
    }
    
    @media (max-width: 480px) {
      .kpis {
        grid-template-columns: 1fr;
      }
      
      .header-controls {
        flex-direction: column;
        align-items: stretch;
      }
    }
  </style>
</head>
<body>
  <a href="#main-content" class="skip-link">Skip to main content</a>
  
  <div class="container">
    <header>
      <div class="logo">
        <div class="logo-icon" aria-hidden="true">
          <i class="fas fa-brain"></i>
        </div>
        <div class="logo-text">
          <h1>Food2Energy â€” AI Sustainability Dashboard</h1>
          <p>AI-powered waste conversion optimization and environmental impact</p>
        </div>
      </div>
      <div class="header-controls">
        <div class="last-update">Last update: <span id="lastUpdate">Just now</span></div>
        <button id="toggleBtn" aria-label="Pause live updates">
          <i class="fas fa-pause"></i>
          <span>Pause Updates</span>
        </button>
        <button class="export-btn" id="exportBtn" aria-label="Export data">
          <i class="fas fa-download"></i>
          <span>Export Data</span>
        </button>
      </div>
    </header>

    <main id="main-content">
      <!-- KPI Cards -->
      <div class="kpis">
        <div class="card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-trash"></i>
            </div>
            <div>
              <div class="card-title">Food Waste Diverted</div>
              <div class="card-value" id="kpiFood" aria-live="polite">0 kg</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> 12% from last week</div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-fire"></i>
            </div>
            <div>
              <div class="card-title">Biogas Produced</div>
              <div class="card-value" id="kpiMethane" aria-live="polite">0 mÂ³</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> 8% from last week</div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-seedling"></i>
            </div>
            <div>
              <div class="card-title">Fertilizer Output</div>
              <div class="card-value" id="kpiFertilizer" aria-live="polite">0 L</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> 10% from last week</div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-wind"></i>
            </div>
            <div>
              <div class="card-title">Methane Avoided</div>
              <div class="card-value" id="kpiAvoided" aria-live="polite">0 kg</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> 5% from last week</div>
        </div>
        <div class="card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-award"></i>
            </div>
            <div>
              <div class="card-title">Carbon Credits</div>
              <div class="card-value" id="kpiCarbon" aria-live="polite">0</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> 7% from last week</div>
        </div>
        <div class="card ai-score-card">
          <div class="card-header">
            <div class="card-icon" aria-hidden="true">
              <i class="fas fa-robot"></i>
            </div>
            <div>
              <div class="card-title">AI Efficiency Score</div>
              <div class="card-value" id="aiScore" aria-live="polite">0%</div>
            </div>
          </div>
          <div class="card-trend"><i class="fas fa-arrow-up"></i> <span id="aiTrend">0%</span> from last week</div>
        </div>
      </div>

      <!-- Charts + AI Panel -->
      <div class="dashboard-content">
        <div class="panel">
          <div class="panel-header">
            <div class="panel-title">Waste Conversion Metrics <span class="anomaly-indicator" id="anomalyIndicator">No anomalies</span></div>
            <div class="time-filter">
              <select id="timeRange" aria-label="Select time range">
                <option value="7">Last 7 days</option>
                <option value="14" selected>Last 14 days</option>
                <option value="30">Last 30 days</option>
              </select>
            </div>
          </div>
          <div class="chart-container">
            <canvas id="lineChart" aria-label="Waste conversion metrics chart"></canvas>
          </div>
          
          <div class="chart-controls">
            <button class="chart-btn active" data-chart="lineChart" data-dataset="0">Food Waste</button>
            <button class="chart-btn active" data-chart="lineChart" data-dataset="1">Biogas</button>
            <button class="chart-btn" data-chart="lineChart" data-dataset="2">Fertilizer</button>
          </div>
          
          <div class="chart-grid" style="margin-top: 30px;">
            <div>
              <div class="panel-header">
                <div class="panel-title">Methane Avoided (Weekly)</div>
              </div>
              <div class="chart-container" style="height: 250px;">
                <canvas id="barChart" aria-label="Methane avoided weekly chart"></canvas>
              </div>
            </div>
            <div>
              <div class="panel-header">
                <div class="panel-title">Output Distribution</div>
              </div>
              <div class="chart-container" style="height: 250px;">
                <canvas id="doughnutChart" aria-label="Output distribution chart"></canvas>
              </div>
            </div>
          </div>
          
          <div class="panel-header" style="margin-top: 30px;">
            <div class="panel-title">AI-Powered 7-Day Forecast</div>
          </div>
          <div class="forecast-container">
            <canvas id="forecastChart" aria-label="Biogas production forecast chart"></canvas>
          </div>
          
          <div class="forecast-explanation" id="forecastExplanation">
            <strong>Forecast Analysis:</strong> Based on historical data and current trends, our AI predicts biogas production will continue to increase over the next 7 days.
          </div>
        </div>

        <div class="panel ai-panel">
          <div class="panel-header">
            <div class="panel-title">AI Recommendations</div>
            <i class="fas fa-robot" style="color: var(--ai-primary); font-size: 20px;" aria-hidden="true"></i>
          </div>
          <div id="recs"></div>
          
          <div class="ai-efficiency">
            <div class="panel-header">
              <div class="panel-title">AI Efficiency Analysis</div>
            </div>
            <div class="efficiency-metrics">
              <div class="efficiency-metric">
                <div class="metric-value" id="conversionRate">0%</div>
                <div class="metric-label">Conversion Rate</div>
              </div>
              <div class="efficiency-metric">
                <div class="metric-value" id="optimizationPotential">0%</div>
                <div class="metric-label">Optimization Potential</div>
              </div>
              <div class="efficiency-metric">
                <div class="metric-value" id="predictionAccuracy">0%</div>
                <div class="metric-label">Prediction Accuracy</div>
              </div>
            </div>
          </div>
          
          <div class="alert-center">
            <div class="panel-header">
              <div class="panel-title">AI Alert Center</div>
              <i class="fas fa-bell" style="color: var(--ai-secondary);" aria-hidden="true"></i>
            </div>
            <div id="alertsContainer">
              <!-- Alerts will be inserted here by JavaScript -->
            </div>
          </div>
          
          <div class="sensor-snapshot">
            <div class="sensor-title">Live Sensor Data</div>
            <div class="sensor-data">
              <div class="sensor-item">
                <div class="sensor-label">Recent Input</div>
                <div class="sensor-value" id="sensorFood">0 kg</div>
              </div>
              <div class="sensor-item">
                <div class="sensor-label">Biogas</div>
                <div class="sensor-value" id="sensorMethane">0 mÂ³</div>
              </div>
              <div class="sensor-item">
                <div class="sensor-label">Fertilizer</div>
                <div class="sensor-value" id="sensorFertilizer">0 L</div>
              </div>
              <div class="sensor-item">
                <div class="sensor-label">pH Level</div>
                <div class="sensor-value" id="sensorPH">0</div>
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>

    <footer>
      AI-Powered Sustainability Dashboard â€” Machine learning models optimize waste conversion in real-time.
      <br>Â© 2023 Food2Energy â€” Sustainable Waste Solutions
    </footer>
  </div>

  <script>
    // === DATA SETUP ===
    const days = 14;
    let series = [];
    const today = new Date();
    
    function initializeData(daysCount) {
      series = [];
      for (let i = daysCount - 1; i >= 0; i--) {
        const d = new Date(today);
        d.setDate(today.getDate() - i);
        const food = Math.round(80 + Math.random() * 120);
        const methane = +(food * (0.45 + Math.random() * 0.15)).toFixed(2);
        const avoided = +(food * 0.05).toFixed(2);
        const fertilizer = +(food * 0.6).toFixed(1);
        const carbon = Math.round(avoided * 0.8);
        const pH = +(6.8 + Math.random() * 0.8).toFixed(2);
        const temperature = +(35 + Math.random() * 10).toFixed(1);
        series.push({date: d.toISOString().slice(0,10), food, methane, avoided, fertilizer, carbon, pH, temperature});
      }
      updateAllCharts();
    }
    
    function updateKPIs() {
      const totalFood = series.reduce((s,p)=>s+p.food,0);
      const totalMethane = series.reduce((s,p)=>s+p.methane,0).toFixed(2);
      const totalAvoided = series.reduce((s,p)=>s+p.avoided,0).toFixed(2);
      const totalFert = series.reduce((s,p)=>s+p.fertilizer,0).toFixed(1);
      const totalCarbon = series.reduce((s,p)=>s+p.carbon,0);

      document.getElementById("kpiFood").innerText = totalFood+" kg";
      document.getElementById("kpiMethane").innerText = totalMethane+" mÂ³";
      document.getElementById("kpiAvoided").innerText = totalAvoided+" kg";
      document.getElementById("kpiFertilizer").innerText = totalFert+" L";
      document.getElementById("kpiCarbon").innerText = totalCarbon;
      
      // Update last update time
      document.getElementById("lastUpdate").innerText = new Date().toLocaleTimeString();
    }

    // === AI FUNCTIONS ===
    function calculateAIScore() {
      // Calculate efficiency score based on various metrics
      const latest = series[series.length-1];
      const avgMethane = series.reduce((sum, day) => sum + day.methane, 0) / series.length;
      const avgFood = series.reduce((sum, day) => sum + day.food, 0) / series.length;
      
      // Conversion efficiency (methane per kg of food)
      const conversionEfficiency = (latest.methane / latest.food) / 0.5 * 100;
      
      // pH stability score (ideal range 6.8-7.2)
      const pHScore = Math.max(0, 100 - Math.abs(latest.pH - 7) * 50);
      
      // Temperature stability score (ideal range 35-40Â°C)
      const tempScore = Math.max(0, 100 - Math.abs(latest.temperature - 37.5) * 10);
      
      // Consistency score (how stable production is)
      const consistencyScore = Math.max(0, 100 - (Math.abs(latest.methane - avgMethane) / avgMethane * 100));
      
      // Weighted average of all scores
      const aiScore = Math.min(100, Math.round(
        conversionEfficiency * 0.4 + 
        pHScore * 0.2 + 
        tempScore * 0.2 + 
        consistencyScore * 0.2
      ));
      
      // Calculate trend
      const prevWeekAvg = series.slice(-7, -1).reduce((sum, day) => sum + day.methane, 0) / 6;
      const trend = prevWeekAvg ? ((avgMethane - prevWeekAvg) / prevWeekAvg * 100).toFixed(1) : 0;
      
      document.getElementById("aiScore").innerText = aiScore + "%";
      document.getElementById("aiTrend").innerText = Math.abs(trend) + "%";
      
      return aiScore;
    }
    
    function updateEfficiencyMetrics() {
      const latest = series[series.length-1];
      
      // Conversion rate (methane per kg of food)
      const conversionRate = Math.min(100, Math.round((latest.methane / latest.food) / 0.5 * 100));
      document.getElementById("conversionRate").innerText = conversionRate + "%";
      
      // Optimization potential (how much we can improve)
      const optimizationPotential = Math.round(100 - conversionRate);
      document.getElementById("optimizationPotential").innerText = optimizationPotential + "%";
      
      // Prediction accuracy (simulated)
      const predictionAccuracy = 85 + Math.floor(Math.random() * 10);
      document.getElementById("predictionAccuracy").innerText = predictionAccuracy + "%";
    }
    
    function detectAnomalies() {
      const latest = series[series.length-1];
      const previous = series[series.length-2];
      
      if (!previous) return "none";
      
      // Check for significant changes
      const methaneChange = Math.abs(latest.methane - previous.methane) / previous.methane;
      const foodChange = Math.abs(latest.food - previous.food) / previous.food;
      const pHChange = Math.abs(latest.pH - previous.pH);
      const tempChange = Math.abs(latest.temperature - previous.temperature);
      
      let anomalyLevel = "none";
      const anomalyIndicator = document.getElementById("anomalyIndicator");
      
      if (methaneChange > 0.4 || foodChange > 0.5 || pHChange > 0.8 || tempChange > 5) {
        anomalyLevel = "major";
        anomalyIndicator.className = "anomaly-indicator anomaly-major";
        anomalyIndicator.innerHTML = "Major anomaly detected";
      } else if (methaneChange > 0.25 || foodChange > 0.3 || pHChange > 0.5 || tempChange > 3) {
        anomalyLevel = "minor";
        anomalyIndicator.className = "anomaly-indicator anomaly-minor";
        anomalyIndicator.innerHTML = "Minor anomaly detected";
      } else {
        anomalyIndicator.className = "anomaly-indicator anomaly-none";
        anomalyIndicator.innerHTML = "No anomalies";
      }
      
      return anomalyLevel;
    }
    
    function generateAlerts() {
      const alertsContainer = document.getElementById("alertsContainer");
      alertsContainer.innerHTML = "";
      const latest = series[series.length-1];
      
      // Sample alerts (in a real system, these would be generated by ML models)
      const alerts = [];
      
      // pH alert
      if (latest.pH < 6.5) {
        alerts.push({
          level: "high",
          title: "Low pH Level",
          description: "pH has dropped to " + latest.pH + ". Add alkaline buffer to maintain optimal conditions.",
          icon: "fa-vial"
        });
      } else if (latest.pH > 7.8) {
        alerts.push({
          level: "high",
          title: "High pH Level",
          description: "pH has risen to " + latest.pH + ". Add acidic components to balance.",
          icon: "fa-vial"
        });
      }
      
      // Temperature alert
      if (latest.temperature < 32) {
        alerts.push({
          level: "medium",
          title: "Low Temperature",
          description: "Temperature is " + latest.temperature + "Â°C. Heating may be required for optimal digestion.",
          icon: "fa-temperature-low"
        });
      } else if (latest.temperature > 42) {
        alerts.push({
          level: "medium",
          title: "High Temperature",
          description: "Temperature is " + latest.temperature + "Â°C. Consider cooling to prevent microbe die-off.",
          icon: "fa-temperature-high"
        });
      }
      
      // Efficiency alert
      const efficiency = (latest.methane / latest.food) / 0.5 * 100;
      if (efficiency < 70) {
        alerts.push({
          level: "medium",
          title: "Low Conversion Efficiency",
          description: "Current efficiency is " + Math.round(efficiency) + "%. Review waste mix ratios.",
          icon: "fa-tachometer-alt"
        });
      }
      
      // Maintenance alert (randomized)
      if (Math.random() > 0.7) {
        alerts.push({
          level: "low",
          title: "Routine Maintenance Due",
          description: "System inspection and maintenance recommended in the next 7 days.",
          icon: "fa-tools"
        });
      }
      
      // Add alerts to container
      if (alerts.length === 0) {
        alertsContainer.innerHTML = '<div class="alert-item alert-low">' +
          '<div class="alert-icon"><i class="fas fa-check-circle"></i></div>' +
          '<div class="alert-info">' +
          '<div class="alert-title">All Systems Normal</div>' +
          '<div class="alert-desc">No alerts at this time</div>' +
          '</div></div>';
      } else {
        alerts.forEach(alert => {
          const alertEl = document.createElement("div");
          alertEl.className = `alert-item alert-${alert.level}`;
          alertEl.innerHTML = `
            <div class="alert-icon"><i class="fas ${alert.icon}"></i></div>
            <div class="alert-info">
              <div class="alert-title">${alert.title}</div>
              <div class="alert-desc">${alert.description}</div>
            </div>
          `;
          alertsContainer.appendChild(alertEl);
        });
      }
    }

    // === CHARTS ===
    let lineChart, barChart, doughnutChart, forecastChart;
    
    function initializeCharts() {
      const lineCtx = document.getElementById("lineChart").getContext("2d");
      lineChart = new Chart(lineCtx, {
        type: "line",
        data: {
          labels: series.map(s=>s.date),
          datasets: [
            { 
              label:"Food Waste (kg)", 
              data:series.map(s=>s.food), 
              borderColor: "#16a34a",
              backgroundColor: "rgba(22, 163, 74, 0.1)",
              fill: true,
              tension: 0.4,
              borderWidth: 2,
              pointBackgroundColor: "#16a34a",
              pointRadius: 3,
              pointHoverRadius: 6,
              hidden: false
            },
            { 
              label:"Biogas (mÂ³)", 
              data:series.map(s=>s.methane), 
              borderColor: "#FF8C00",
              backgroundColor: "rgba(255, 140, 0, 0.1)",
              fill: true,
              tension: 0.4,
              borderWidth: 2,
              pointBackgroundColor: "#FF8C00",
              pointRadius: 3,
              pointHoverRadius: 6,
              hidden: false
            },
            { 
              label:"Fertilizer (L)", 
              data:series.map(s=>s.fertilizer), 
              borderColor: "#F2D000",
              backgroundColor: "rgba(242, 208, 0, 0.1)",
              fill: true,
              tension: 0.4,
              borderWidth: 2,
              pointBackgroundColor: "#F2D000",
              pointRadius: 3,
              pointHoverRadius: 6,
              hidden: true
            }
          ]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              },
              ticks: {
                maxRotation: 90,
                minRotation: 45,
                autoSkip: true,
                maxTicksLimit: 14
                }
            }
          }
        }
      });

      const barCtx = document.getElementById("barChart").getContext("2d");
      barChart = new Chart(barCtx, {
        type: "bar",
        data: {
          labels: ["W1","W2"],
          datasets: [
            { 
              label:"Methane Avoided (kg)", 
              data:[0,0], 
              backgroundColor: "#000066",
              borderRadius: 6,
              borderWidth: 0
            }
          ]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: false,
          plugins: {
            legend: {
              display: false
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
      
      const doughnutCtx = document.getElementById("doughnutChart").getContext("2d");
      doughnutChart = new Chart(doughnutCtx, {
        type: "doughnut",
        data: {
          labels: ["Biogas", "Fertilizer", "Methane Avoided"],
          datasets: [{
            data: [0, 0, 0],
            backgroundColor: [
              '#FF8C00', // Biogas - Orange
              '#F2D000', // Fertilizer - Yellow
              '#000066'  // Methane Avoided - Dark Blue
            ],
            borderWidth: 0,
            hoverOffset: 12
          }]
        },
        options: {
          responsive: true,
          maintainAspectRatio: false,
          cutout: '70%',
          plugins: {
            legend: {
              position: 'bottom'
            }
          }
        }
      });
      
      // Forecast chart
      const forecastCtx = document.getElementById("forecastChart").getContext("2d");
      forecastChart = new Chart(forecastCtx, {
        type: "line",
        data: {
          labels: [],
          datasets: [
            { 
              label:"Predicted Biogas", 
              data:[],
              borderColor: "#9333EA",
              backgroundColor: "rgba(147, 51, 234, 0.1)",
              fill: true,
              tension: 0.4,
              borderWidth: 2,
              borderDash: [5, 5],
              pointBackgroundColor: "#9333EA",
              pointRadius: 3,
              pointHoverRadius: 6
            },
            { 
              label:"Historical Biogas", 
              data:[],
              borderColor: "#FF8C00",
              backgroundColor: "transparent",
              fill: false,
              tension: 0.4,
              borderWidth: 2,
              pointBackgroundColor: "#FF8C00",
              pointRadius: 3,
              pointHoverRadius: 6
            }
          ]
        },
        options: { 
          responsive: true, 
          maintainAspectRatio: false,
          plugins: {
            legend: {
              position: 'top',
              labels: {
                usePointStyle: true,
                padding: 20
              }
            }
          },
          scales: {
            y: {
              beginAtZero: true,
              grid: {
                drawBorder: false
              }
            },
            x: {
              grid: {
                display: false
              }
            }
          }
        }
      });
    }
    
    function updateAllCharts() {
      if (!lineChart || !barChart || !doughnutChart || !forecastChart) return;
      
      lineChart.data.labels = series.map(s=>s.date);
      lineChart.data.datasets[0].data = series.map(s=>s.food);
      lineChart.data.datasets[1].data = series.map(s=>s.methane);
      lineChart.data.datasets[2].data = series.map(s=>s.fertilizer);
      lineChart.update();
      
      const weeks = [0,0,0,0];
      series.forEach((s,i)=>{weeks[Math.floor(i/7)] += s.avoided;});
      barChart.data.labels = weeks.map((_,i)=>"W"+(i+1));
      barChart.data.datasets[0].data = weeks;
      barChart.update();
      
      const totalMethane = series.reduce((s,p)=>s+p.methane,0);
      const totalFertilizer = series.reduce((s,p)=>s+p.fertilizer,0);
      const totalAvoided = series.reduce((s,p)=>s+p.avoided,0);
      
      doughnutChart.data.datasets[0].data = [totalMethane, totalFertilizer, totalAvoided];
      doughnutChart.update();
      
      // Update forecast chart
      updateForecast();
    }
    
    function updateForecast() {
      // Simple forecasting based on recent trend
      const last7Days = series.slice(-7).map(s => s.methane);
      const avg = last7Days.reduce((a, b) => a + b, 0) / last7Days.length;
      const trend = (last7Days[6] - last7Days[0]) / 6;
      
      const forecastData = [];
      for (let i = 1; i <= 7; i++) {
        forecastData.push(avg + trend * i * (0.8 + Math.random() * 0.4));
      }
      
      const lastDate = new Date(series[series.length-1].date);
      const forecastLabels = [];
      for (let i = 1; i <= 7; i++) {
        const nextDate = new Date(lastDate);
        nextDate.setDate(lastDate.getDate() + i);
        forecastLabels.push(nextDate.toISOString().slice(5,10));
      }
      
      forecastChart.data.labels = forecastLabels;
      forecastChart.data.datasets[0].data = forecastData;
      forecastChart.data.datasets[1].data = last7Days;
      forecastChart.update();
      
      // Update forecast explanation
      const explanation = document.getElementById("forecastExplanation");
      if (trend > 0) {
        explanation.innerHTML = `<strong>Forecast Analysis:</strong> Based on historical data and current trends, our AI predicts biogas production will increase by approximately ${Math.abs(trend).toFixed(1)}% daily over the next 7 days.`;
      } else if (trend < 0) {
        explanation.innerHTML = `<strong>Forecast Analysis:</strong> Our AI detects a decreasing trend in biogas production. We predict a daily decrease of approximately ${Math.abs(trend).toFixed(1)}% over the next week unless adjustments are made.`;
      } else {
        explanation.innerHTML = `<strong>Forecast Analysis:</strong> Production appears stable. Our AI predicts consistent biogas output over the next 7 days with minimal fluctuations.`;
      }
    }

    // === AI Recommendations ===
    function updateRecs() {
      const recsDiv = document.getElementById("recs");
      recsDiv.innerHTML="";
      const latest = series[series.length-1];
      const prevAvg = series.slice(-4,-1).reduce((s,p)=>s+p.methane,0)/3 || latest.methane;
      const recs=[];
      
      // System status
      if(Math.abs(latest.methane-prevAvg)/Math.max(1,prevAvg)<0.15){
        recs.push({level:"good", icon:"fa-check-circle", text:"System stable: continue current waste mix."});
      }
      if(latest.methane<prevAvg*0.8){
        recs.push({level:"warning", icon:"fa-exclamation-triangle", text:"Biogas production dropping: add starchy waste (bread, roots)."});
      }
      if(latest.pH<6.6){
        recs.push({level:"alert", icon:"fa-exclamation-circle", text:"Acidity rising: add fibrous material or manure."});
      }
      if(latest.pH>7.8){
        recs.push({level:"notice", icon:"fa-info-circle", text:"pH high: check buffer or reduce alkaline inputs."});
      }
      
      // AI-powered recommendations
      const aiScore = calculateAIScore();
      if (aiScore < 70) {
        recs.push({level:"ai-insight", icon:"fa-lightbulb", text:"AI suggests adjusting waste mix ratio to 60% greens, 40% browns for optimal output."});
      }
      
      // Temperature-based recommendations
      if (latest.temperature < 34) {
        recs.push({level:"warning", icon:"fa-temperature-low", text:"Temperature below optimal range. Consider increasing heating."});
      } else if (latest.temperature > 41) {
        recs.push({level:"warning", icon:"fa-temperature-high", text:"Temperature above optimal range. Consider cooling measures."});
      }
      
      // Forecasting insights
      const forecastTrend = series.slice(-3).map(s => s.methane);
      if (forecastTrend[2] > forecastTrend[1] && forecastTrend[1] > forecastTrend[0]) {
        recs.push({level:"ai-insight", icon:"fa-chart-line", text:"Positive production trend detected. Consider increasing input volume by 15%."});
      }
      
      if(recs.length===0) recs.push({level:"good", icon:"fa-check-circle", text:"No anomalies detected. Keep operating."});
      
      recs.forEach(r=>{
        const d=document.createElement("div");
        d.className="recommendation "+r.level;
        d.innerHTML=`<i class="fas ${r.icon}"></i><span>${r.text}</span>`;
        recsDiv.appendChild(d);
      });
    }

    // === CHART CONTROLS ===
    function setupChartControls() {
      // Add event listeners to chart control buttons
      document.querySelectorAll('.chart-btn').forEach(btn => {
        btn.addEventListener('click', function() {
          const chartName = this.getAttribute('data-chart');
          const datasetIndex = parseInt(this.getAttribute('data-dataset'));
          const chart = getChartByName(chartName);
          
          if (chart) {
            const meta = chart.getDatasetMeta(datasetIndex);
            meta.hidden = !meta.hidden;
            chart.update();
            
            // Update button state
            this.classList.toggle('active');
          }
        });
      });
    }
    
    function getChartByName(name) {
      switch(name) {
        case 'lineChart': return lineChart;
        case 'barChart': return barChart;
        case 'doughnutChart': return doughnutChart;
        case 'forecastChart': return forecastChart;
        default: return null;
      }
    }
    
    // === DATA EXPORT ===
    function setupDataExport() {
      document.getElementById('exportBtn').addEventListener('click', function() {
        // Convert data to CSV format
        const headers = ['Date', 'Food Waste (kg)', 'Biogas (mÂ³)', 'Fertilizer (L)', 'Methane Avoided (kg)', 'Carbon Credits', 'pH', 'Temperature (Â°C)'];
        const csvData = [
          headers.join(','),
          ...series.map(day => [
            day.date,
            day.food,
            day.methane,
            day.fertilizer,
            day.avoided,
            day.carbon,
            day.pH,
            day.temperature
          ].join(','))
        ].join('\n');
        
        // Create download link
        const blob = new Blob([csvData], { type: 'text/csv' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `food2energy-data-${new Date().toISOString().slice(0,10)}.csv`;
        document.body.appendChild(a);
        a.click();
        document.body.removeChild(a);
        URL.revokeObjectURL(url);
      });
    }

    // === LIVE SIMULATION ===
    let live = true;
    document.getElementById("toggleBtn").onclick=()=>{
      live=!live;
      document.getElementById("toggleBtn").innerHTML = live ? 
        '<i class="fas fa-pause"></i><span>Pause Updates</span>' : 
        '<i class="fas fa-play"></i><span>Resume Updates</span>';
      document.getElementById("toggleBtn").setAttribute('aria-label', live ? 'Pause live updates' : 'Resume live updates');
    };
    
    // Time range filter
    document.getElementById("timeRange").addEventListener("change", function() {
      initializeData(parseInt(this.value));
      updateKPIs();
      updateRecs();
    });

    function tick() {
      if(!live) return;
      const now=new Date();
      const food=Math.round(30+Math.random()*120);
      const methane=+(food*(0.45+Math.random()*0.15)).toFixed(2);
      const avoided=+(food*0.05).toFixed(2);
      const fertilizer=+(food*0.6).toFixed(1);
      const carbon=Math.round(avoided * 0.8);
      const pH=+(6.4+Math.random()*1.2).toFixed(2);
      const temperature = +(35 + Math.random() * 10).toFixed(1);
      const today=now.toISOString().slice(0,10);

      let last=series[series.length-1];
      if(last.date===today){
        last.food+=food;
        last.methane=+(last.methane+methane).toFixed(2);
        last.avoided=+(last.avoided+avoided).toFixed(2);
        last.fertilizer=+(last.fertilizer+fertilizer).toFixed(1);
        last.carbon+=carbon;
        last.pH=+((last.pH+pH)/2).toFixed(2);
        last.temperature=+((last.temperature+temperature)/2).toFixed(1);
      } else {
        // If we have a new day, remove the first element to maintain the same number of days
        if (series.length >= parseInt(document.getElementById("timeRange").value)) {
          series.shift();
        }
        series.push({date:today, food, methane, avoided, fertilizer, carbon, pH, temperature});
      }

      // Update sensor snapshot
      document.getElementById("sensorFood").innerText = `${food} kg`;
      document.getElementById("sensorMethane").innerText = `${methane} mÂ³`;
      document.getElementById("sensorFertilizer").innerText = `${fertilizer} L`;
      document.getElementById("sensorPH").innerText = pH;

      updateKPIs();
      updateRecs();
      updateEfficiencyMetrics();
      detectAnomalies();
      generateAlerts();
      updateAllCharts();
    }

    // Initialize the dashboard
    initializeData(days);
    initializeCharts();
    updateKPIs();
    updateRecs();
    updateEfficiencyMetrics();
    detectAnomalies();
    generateAlerts();
    setupChartControls();
    setupDataExport();
    setInterval(tick, 5000);
  </script>
</body>
</html>
